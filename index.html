<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kafe SipariÅŸ</title>

<style>
:root{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#eee;
}
body.light{
  --bg:#f4f4f4;
  --card:#ffffff;
  --text:#000;
}
body{
  background:var(--bg);
  color:var(--text);
  margin:0;
  font-family:Arial;
}
h2,h3{text-align:center}

.panel{
  display:flex;
  gap:8px;
  padding:10px;
  flex-wrap:wrap;
  justify-content:center;
}
.panel input,button{
  padding:8px;
  border:none;
  border-radius:6px;
}
.panel button{background:#4caf50;color:#fff}
.themeBtn{background:#ff9800;color:#000}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:20px;
  padding:15px;
}
.card{
  background:var(--card);
  padding:15px;
  border-radius:14px;
}

.item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin:8px 0;
}
.drag{
  font-size:18px;
  padding-right:6px;
  user-select:none;
  touch-action:manipulation; /* Ã–NEMLÄ° */
}
.item-controls button{
  background:#333;
  color:#fff;
  border-radius:5px;
}

.total{margin-top:10px;font-weight:bold}
.save{background:#1976d2;color:#fff;width:100%;margin-top:6px}
.clear{background:#c62828;color:#fff;width:100%;margin-top:6px}

#kayitlar{
  background:var(--card);
  margin:15px;
  padding:15px;
  border-radius:12px;
}
.kayit{
  display:flex;
  justify-content:space-between;
  border-bottom:1px dashed #555;
  padding:6px 0;
}
.kayit button{
  background:#c62828;
  color:#fff;
  border-radius:5px;
}
</style>
</head>

<body>

<h2>â˜• Kafe SipariÅŸ</h2>

<div class="panel">
  <input id="urunAdi" placeholder="ÃœrÃ¼n adÄ±">
  <input id="urunFiyat" type="number" placeholder="Fiyat">
  <button onclick="urunEkle()">ÃœrÃ¼n Ekle</button>
  <button class="themeBtn" onclick="temaDegis()">Tema</button>
</div>

<div class="container" id="container"></div>

<div id="kayitlar">
  <h3>ðŸ“Š GÃ¼nlÃ¼k KayÄ±t</h3>
  <input type="date" id="tarihAra">
  <button onclick="tariheGore()">Ara</button>
  <button onclick="tumunuGoster()">TÃ¼mÃ¼</button>
  <div id="ciro"></div>
  <div id="liste"></div>
</div>

<script>
const masalar=[
  ...Array.from({length:16},(_,i)=>"Masa "+(i+1)),
  "KapÄ± Ã–nÃ¼","Yeni","Cam"
];

let urunSirasi=JSON.parse(localStorage.getItem("urunSirasi"))||["cay","tost","icecek"];
let urunler={
  cay:{ad:"Ã‡ay",fiyat:20},
  tost:{ad:"Tost",fiyat:170},
  icecek:{ad:"Ä°Ã§ecek",fiyat:70}
};
let siparis=JSON.parse(localStorage.getItem("siparis"))||{};
let kayitlar=JSON.parse(localStorage.getItem("kayitlar"))||[];

function today(){return new Date().toISOString().split("T")[0];}
function kaydet(){
  localStorage.setItem("siparis",JSON.stringify(siparis));
  localStorage.setItem("kayitlar",JSON.stringify(kayitlar));
  localStorage.setItem("urunSirasi",JSON.stringify(urunSirasi));
}
function toplam(m){
  return urunSirasi.reduce((t,k)=>t+(siparis[m][k]||0)*urunler[k].fiyat,0);
}

let dragKey=null;
let holdTimer=null;
let dragActive=false;

function ciz(){
  container.innerHTML="";
  masalar.forEach(m=>{
    siparis[m]=siparis[m]||{};
    let h=`<div class="card"><h4>${m}</h4>`;
    urunSirasi.forEach(k=>{
      siparis[m][k]=siparis[m][k]||0;
      h+=`
      <div class="item">
        <span class="drag"
          ontouchstart="holdStart(event,'${k}')"
          ontouchmove="dragMove(event)"
          ontouchend="holdEnd()">â‰¡</span>
        ${urunler[k].ad}
        <div class="item-controls">
          <button onclick="degis('${m}','${k}',-1)">-</button>
          ${siparis[m][k]}
          <button onclick="degis('${m}','${k}',1)">+</button>
        </div>
      </div>`;
    });
    h+=`
    <div class="total">Toplam: ${toplam(m)} TL</div>
    <button class="save" onclick="kaydetGunluk('${m}')">Kaydet</button>
    <button class="clear" onclick="temizle('${m}')">Temizle</button>
    </div>`;
    container.innerHTML+=h;
  });
  kaydet();
}

function holdStart(e,k){
  holdTimer=setTimeout(()=>{
    dragKey=k;
    dragActive=true;
  },500);
}

function holdEnd(){
  clearTimeout(holdTimer);
  dragKey=null;
  dragActive=false;
}

function dragMove(e){
  if(!dragActive) return;
  e.preventDefault(); // ðŸ”´ ASIL DÃœZELTME BU
  let y=e.touches[0].clientY;
  let items=[...document.querySelectorAll(".item")];

  items.forEach((el,i)=>{
    let r=el.getBoundingClientRect();
    if(y>r.top && y<r.bottom){
      let targetKey=urunSirasi[i];
      let a=urunSirasi.indexOf(dragKey);
      let b=i;
      if(a!==b){
        urunSirasi.splice(b,0,urunSirasi.splice(a,1)[0]);
        ciz();
      }
    }
  });
}

function degis(m,k,d){
  siparis[m][k]=Math.max(0,(siparis[m][k]||0)+d);
  ciz();
}
function temizle(m){
  urunSirasi.forEach(k=>siparis[m][k]=0);
  ciz();
}
function kaydetGunluk(m){
  let t=toplam(m);
  if(!t)return;
  kayitlar.push({tarih:today(),masa:m,toplam:t});
  temizle(m);
  goster(kayitlar);
}
function goster(l){
  liste.innerHTML="";
  let t=0;
  l.forEach((k,i)=>{
    t+=k.toplam;
    liste.innerHTML+=`
    <div class="kayit">
      ${k.tarih} - ${k.masa} <b>${k.toplam} TL</b>
      <button onclick="sil(${i})">Sil</button>
    </div>`;
  });
  ciro.innerText="Toplam Ciro: "+t+" TL";
}
function sil(i){
  kayitlar.splice(i,1);
  kaydet();
  goster(kayitlar);
}
function tariheGore(){
  goster(kayitlar.filter(k=>k.tarih===tarihAra.value));
}
function tumunuGoster(){goster(kayitlar);}
function urunEkle(){
  let a=urunAdi.value,f=+urunFiyat.value;
  if(!a||!f)return;
  let k=a.toLowerCase().replace(/\s+/g,"");
  urunler[k]={ad:a,fiyat:f};
  urunSirasi.push(k);
  urunAdi.value=urunFiyat.value="";
  ciz();
}
function temaDegis(){document.body.classList.toggle("light");}

ciz();
goster(kayitlar);
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kafe Pro</title>
<style>
body{margin:0;font-family:Segoe UI;background:#111;color:#fff}
.container{display:flex;height:100vh}
.sidebar{width:200px;background:#1b1b1b;padding:10px;overflow:auto}
.table-btn{width:100%;padding:12px;margin-bottom:8px;background:#333;border:none;color:#fff;border-radius:8px;cursor:pointer}
.table-btn.active{background:#e94560}
.main{flex:1;display:flex;flex-direction:column}
.header{padding:15px;background:#1a1a2e;display:flex;justify-content:space-between}
.content{flex:1;display:flex}
.products{flex:1;padding:15px;overflow:auto}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
.product{background:#222;padding:10px;border-radius:10px;text-align:center}
.product button{width:100%;margin-top:5px;background:#e94560;border:none;padding:6px;color:#fff;border-radius:6px}
.order{width:350px;background:#1b1b1b;padding:15px;display:flex;flex-direction:column}
.order-items{flex:1;overflow:auto}
.order-item{background:#222;padding:8px;margin-bottom:8px;border-radius:8px}
.total{font-size:20px;margin-top:10px}
button{cursor:pointer}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);justify-content:center;align-items:center}
.modal-content{background:#1a1a2e;padding:20px;border-radius:15px;width:600px;max-height:80vh;overflow:auto}
.close{float:right;background:red;border:none;color:#fff;border-radius:50%;width:30px;height:30px}
.order-record{background:#222;padding:10px;margin-bottom:10px;border-radius:10px}
.delete-order-btn{float:right;background:red;border:none;color:#fff;border-radius:50%;width:25px;height:25px}
</style>
</head>
<body>

<div class="container">

<div class="sidebar">
<h3>Masalar</h3>
<div id="tables"></div>
<button onclick="addTable()">+ Masa</button>
</div>

<div class="main">

<div class="header">
<div id="currentTable">Masa seç</div>
<div>
Günlük: <span id="dailyRevenue">0 ₺</span> |
Haftalık: <span id="weeklyRevenue">0 ₺</span>
</div>
</div>

<div class="content">

<div class="products">
<h3>Ürünler</h3>
<div class="products-grid" id="products"></div>
<button onclick="openReports()">Raporlar</button>
</div>

<div class="order">
<h3>Sipariş</h3>
<div class="order-items" id="orderItems"></div>
<div class="total">Toplam: <span id="total">0 ₺</span></div>
<button onclick="checkout()">Hesabı Kapat</button>
</div>

</div>
</div>
</div>

<div class="modal" id="reportsModal">
<div class="modal-content">
<button class="close" onclick="closeReports()">X</button>
<h3>Satış Raporu</h3>
<div id="reportContent"></div>
<button onclick="clearAllOrders()">Tüm Geçmişi Sil</button>
</div>
</div>

<script>

let tables = JSON.parse(localStorage.getItem("tables")) || [
{id:1,name:"Masa 1"},
{id:2,name:"Masa 2"}
];

let products = [
{id:1,name:"Çay",price:20},
{id:2,name:"Tost",price:170},
{id:3,name:"Kola",price:50}
];

let orders = JSON.parse(localStorage.getItem("orders")) || {};
let orderHistory = JSON.parse(localStorage.getItem("history")) || [];
let dailyRevenue = parseFloat(localStorage.getItem("dailyRevenue")) || 0;
let currentTable = null;

function save(){
localStorage.setItem("tables",JSON.stringify(tables));
localStorage.setItem("orders",JSON.stringify(orders));
localStorage.setItem("history",JSON.stringify(orderHistory));
localStorage.setItem("dailyRevenue",dailyRevenue);
}

function renderTables(){
let div=document.getElementById("tables");
div.innerHTML="";
tables.forEach(t=>{
let btn=document.createElement("button");
btn.className="table-btn"+(currentTable===t.id?" active":"");
btn.innerText=t.name;
btn.onclick=()=>selectTable(t.id);
div.appendChild(btn);
});
}

function selectTable(id){
currentTable=id;
document.getElementById("currentTable").innerText=tables.find(t=>t.id===id).name;
renderTables();
renderOrder();
}

function addTable(){
let name=prompt("Masa adı");
if(!name)return;
tables.push({id:Date.now(),name});
save();
renderTables();
}

function renderProducts(){
let grid=document.getElementById("products");
grid.innerHTML="";
products.forEach(p=>{
let div=document.createElement("div");
div.className="product";
div.innerHTML=`<div>${p.name}</div><div>${p.price} ₺</div>
<button onclick="addToOrder(${p.id})">Ekle</button>`;
grid.appendChild(div);
});
}

function addToOrder(pid){
if(!currentTable){alert("Masa seç");return;}
if(!orders[currentTable])orders[currentTable]=[];
let existing=orders[currentTable].find(i=>i.productId===pid);
let product=products.find(p=>p.id===pid);
if(existing)existing.qty++;
else orders[currentTable].push({productId:pid,name:product.name,price:product.price,qty:1});
save();
renderOrder();
}

function renderOrder(){
let list=document.getElementById("orderItems");
list.innerHTML="";
let total=0;
(orders[currentTable]||[]).forEach((item,i)=>{
total+=item.price*item.qty;
list.innerHTML+=`
<div class="order-item">
${item.name} x${item.qty} (${item.price*item.qty} ₺)
<button onclick="removeItem(${i})">Sil</button>
</div>`;
});
document.getElementById("total").innerText=total+" ₺";
}

function removeItem(i){
orders[currentTable].splice(i,1);
save();
renderOrder();
}

function checkout(){
if(!orders[currentTable]||orders[currentTable].length===0)return;
let total=orders[currentTable].reduce((s,i)=>s+i.price*i.qty,0);
orderHistory.unshift({
id:Date.now(),
date:new Date().toISOString(),
table:tables.find(t=>t.id===currentTable).name,
items:orders[currentTable],
total
});
dailyRevenue+=total;
orders[currentTable]=[];
save();
renderOrder();
updateRevenue();
alert("Hesap kapandı");
}

function updateRevenue(){
document.getElementById("dailyRevenue").innerText=dailyRevenue+" ₺";
let week=new Date();
week.setDate(week.getDate()-7);
let weekly=orderHistory.filter(o=>new Date(o.date)>=week)
.reduce((s,o)=>s+o.total,0);
document.getElementById("weeklyRevenue").innerText=weekly+" ₺";
}

function openReports(){
document.getElementById("reportsModal").style.display="flex";
renderReports();
}

function closeReports(){
document.getElementById("reportsModal").style.display="none";
}

function renderReports(){
let div=document.getElementById("reportContent");
if(orderHistory.length===0){div.innerHTML="Kayıt yok";return;}
div.innerHTML=orderHistory.map(o=>`
<div class="order-record">
<button class="delete-order-btn" onclick="deleteSingleOrder(${o.id})">X</button>
<b>${o.table}</b><br>
${o.items.map(i=>i.name+" x"+i.qty).join("<br>")}
<br><b>${o.total} ₺</b>
</div>
`).join("");
}

function deleteSingleOrder(id){
orderHistory=orderHistory.filter(o=>o.id!==id);
save();
renderReports();
updateRevenue();
}

function clearAllOrders(){
if(!confirm("Hepsi silinsin mi?"))return;
orderHistory=[];
dailyRevenue=0;
save();
renderReports();
updateRevenue();
}

renderTables();
renderProducts();
updateRevenue();

</script>
</body>
</html>
